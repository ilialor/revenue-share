# Архитектура библиотеки расчета выплат (RevShare.js)

## Общая структура проекта
```
/revenue-share-lib/
├── src/                          # Исходный код библиотеки
│   ├── core/                     # Ядро библиотеки
│   │   ├── RevenueSharing.js     # Основной класс
│   │   ├── SchemeValidator.js    # Валидатор схем
│   │   └── PayoutCalculator.js   # Калькулятор выплат
│   ├── schemes/                  # Предустановленные схемы
│   │   ├── index.js              # Экспорт всех схем
│   │   ├── BasicSchemes.js       # Базовые схемы
│   │   └── AdvancedSchemes.js    # Продвинутые схемы
│   ├── utils/                    # Вспомогательные утилиты
│   │   ├── index.js              # Экспорт всех утилит
│   │   ├── ValidationUtils.js    # Утилиты валидации
│   │   └── MathUtils.js          # Математические утилиты
│   └── index.js                  # Главный экспортный файл
├── dist/                         # Скомпилированная библиотека
│   ├── revenue-share.js          # UMD версия
│   ├── revenue-share.min.js      # Минифицированная UMD версия
│   ├── revenue-share.esm.js      # ES модуль
│   └── revenue-share.cjs.js      # CommonJS модуль
├── tests/                        # Тесты
│   ├── unit/                     # Модульные тесты
│   │   ├── core/                 # Тесты ядра
│   │   ├── schemes/              # Тесты схем
│   │   └── utils/                # Тесты утилит
│   ├── integration/              # Интеграционные тесты
│   └── fixtures/                 # Тестовые данные
├── examples/                     # Примеры использования
│   ├── node/                     # Примеры для Node.js
│   ├── browser/                  # Примеры для браузера
│   └── complex-scenarios/        # Сложные сценарии
├── docs/                         # Документация
│   ├── api/                      # API документация
│   ├── examples/                 # Примеры с пояснениями
│   └── guides/                   # Руководства
├── .github/                      # GitHub конфигурации
│   └── workflows/                # CI/CD конфигурации
├── .eslintrc.js                  # ESLint конфигурация
├── .prettierrc                   # Prettier конфигурация
├── jest.config.js                # Jest конфигурация
├── rollup.config.js              # Rollup конфигурация
├── babel.config.js               # Babel конфигурация
├── tsconfig.json                 # TypeScript конфигурация
├── package.json                  # NPM конфигурация
├── README.md                     # Главный README файл
└── LICENSE                       # Лицензия
```

## Архитектурные принципы

### 1. Модульность
Библиотека разделена на независимые модули с четкими границами ответственности:
- **Core** - основные классы для работы с выплатами
- **Schemes** - предопределенные схемы разделения доходов
- **Utils** - вспомогательные функции

### 2. Расширяемость
- Возможность создания пользовательских схем
- Плагинная система для расширения функциональности
- Поддержка middleware для модификации процесса расчета

### 3. Типизация
- Полная поддержка TypeScript
- Строгая валидация входных данных
- Четкие интерфейсы для всех компонентов

### 4. Производительность
- Мемоизация расчетов для повторяющихся операций
- Оптимизация для работы с большим количеством продаж
- Асинхронные API для тяжелых расчетов

### 5. Поддержка различных сред
- Работа в браузере и Node.js
- Поддержка различных форматов модулей (UMD, ESM, CommonJS)
- Минимальные зависимости

## Основные компоненты

### RevenueSharing
Основной класс библиотеки, предоставляющий API для:
- Создания инстанса с параметрами продукта и схемы
- Добавления продаж
- Расчета выплат
- Получения статистики и отчетов

### SchemeValidator
Компонент для проверки валидности схем разделения доходов:
- Проверка структуры схемы
- Валидация процентных соотношений
- Предупреждения о потенциальных проблемах

### PayoutCalculator
Отдельный компонент для вычислений:
- Гибкие алгоритмы расчета
- Поддержка различных типов правил
- Оптимизация для больших объемов данных

## Интерфейс API

```javascript
// Создание инстанса
const revShare = new RevenueSharing({
  productName: 'My Product',
  unitPrice: 100,
  scheme: myScheme
});

// Добавление продаж
revShare.addSale({ buyer: 'buyer1', timestamp: Date.now() });
revShare.addSales([...массив продаж...]);

// Расчет выплат
const payouts = revShare.calculatePayouts();

// Дополнительные методы
revShare.getSalesStats();
revShare.validateScheme();
revShare.exportData();
```

## Рабочий процесс расчета выплат

1. **Инициализация:**
   - Создание инстанса с настройками
   - Валидация схемы

2. **Сбор данных:**
   - Добавление информации о продажах
   - Возможность массового импорта данных

3. **Расчет:**
   - Предварительная обработка данных
   - Применение правил схемы
   - Вычисление долей для каждой стороны

4. **Результаты:**
   - Структурированные данные о выплатах
   - Возможность экспорта в различные форматы

## Типы поддерживаемых схем

1. **Базовые схемы:**
   - Фиксированные проценты для сторон
   - Распределение остатка

2. **Схемы с группами покупателей:**
   - Первые N покупателей
   - Последние M покупателей
   - Случайные группы покупателей

3. **Продвинутые схемы:**
   - Временные окна
   - Объемные пороги (после X продаж)
   - Комбинированные правила

4. **Динамические схемы:**
   - Изменение распределения в зависимости от времени
   - Адаптивное распределение на основе объема продаж
